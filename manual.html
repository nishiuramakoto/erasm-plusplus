<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Erasm++ User&#8217;s Guide</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html --> 
<meta name="src" content="manual.tex"> 
<meta name="date" content="2012-02-02 02:27:00"> 
<link rel="stylesheet" type="text/css" href="manual.css"> 
</head><body 
>
   <div class="maketitle">



<h2 class="titleHead">Erasm++ User&#8217;s Guide</h2>
       <div class="author" ><span 
class="cmr-12">Makoto Nishiura</span>
<br /> <span 
class="cmtt-12">nishiuramakoto@gmail.com</span></div><br />
<div class="date" ><span 
class="cmr-12">February 2, 2012</span></div>
   </div>
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">Introduction</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-30002" id="QQ2-1-3">ERASM++</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.1 <a 
href="#x1-40002.1" id="QQ2-1-4">Overview</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.2 <a 
href="#x1-50002.2" id="QQ2-1-5">Basic Examples</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >2.2.1 <a 
href="#x1-60002.2.1" id="QQ2-1-6">32-bit case</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >2.2.2 <a 
href="#x1-70002.2.2" id="QQ2-1-8">64-bit case</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.3 <a 
href="#x1-80002.3" id="QQ2-1-10">Syntax</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.4 <a 
href="#x1-90002.4" id="QQ2-1-13">Performance</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.5 <a 
href="#x1-100002.5" id="QQ2-1-14">Limitations</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-150003" id="QQ2-1-19">GenericDsm</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.1 <a 
href="#x1-160003.1" id="QQ2-1-20">Overview</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.2 <a 
href="#x1-170003.2" id="QQ2-1-21">Basic Examples</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >3.2.1 <a 
href="#x1-180003.2.1" id="QQ2-1-22">32-bit case</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >3.2.2 <a 
href="#x1-190003.2.2" id="QQ2-1-25">64-bit case</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.3 <a 
href="#x1-200003.3" id="QQ2-1-28">Overview of the API</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.4 <a 
href="#x1-210003.4" id="QQ2-1-30">Performance</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.5 <a 
href="#x1-250003.5" id="QQ2-1-37">Limitations</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-260004" id="QQ2-1-38">License</a></span>
   </div>

<!--l. 312--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>Introduction</h3>
<!--l. 315--><p class="noindent" >Erasm++ is a collection of libraries for runtime code generation, instruction
decoding, and metaprogramming. At the core of these libraries is MetaPrelude, our
Haskell-like lazy metaprogramming library for C++. The emphasis has been on
ease-of-use, runtime performance, and general adaptability at the cost of potentially
increased compile-time resource usage. Our driving motto is this: <span 
class="cmti-10">C++ programs can</span>
<span 
class="cmti-10">be both much faster and more user-friendly at the same time than the functionally</span>
<span 
class="cmti-10">equivalent C programs</span>. As we will show later in this manual, they can sometimes be
an order of magnitude faster without obscure hand-coded optimizations than some
popular C-based libraries.
<!--l. 327--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-30002"></a>ERASM++</h3>
<!--l. 330--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-40002.1"></a>Overview</h4>
<!--l. 333--><p class="noindent" >ERASM++, the Embedded Runtime Assembler in C++, is an Embedded Domain
Specific Language (EDSL) in C++ for runtime code generation. Its main strengths
are:
     <ul class="itemize1">
     <li class="itemize">Close syntactical similarity with the real assembly language.
     </li>
     <li class="itemize">Complete compile-time syntax checking.
     </li>
     <li class="itemize">Very fast and small code generators.
     </li>
     <li class="itemize">When  inlined  and  optimized  by  recent  compilers,  the  code  generator
     functions  compile  to  just  a  series  of  <span 
class="cmtt-10">MOV</span> instructions  that  contain  no
     external references. In particular, they do not require any runtime support.
     </li>
     <li class="itemize">Near full conformance to the C++03 standard subject to the limitations
     concerning the platform&#8217;s data representations (see Section <a 
href="#x1-100002.5">2.5<!--tex4ht:ref: sec:erasm-limitations --></a>).</li></ul>
<!--l. 349--><p class="noindent" >Only the Intel 64/IA-32 architectures are supported at this moment.
<!--l. 351--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-50002.2"></a>Basic Examples</h4>

<!--l. 354--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">2.2.1   </span> <a 
 id="x1-60002.2.1"></a>32-bit case</h5>
<!--l. 357--><p class="noindent" >First, create a file named <span 
class="cmtt-10">demo86.cpp</span><span class="footnote-mark"><a 
href="manual2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-6001f1"></a>
with the following contents:
   <!--l. 361--><div class="lstinputlisting">
<a 
 id="x1-6002"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6003r1"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">x86_addr32_data32</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6004r2"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">iostream</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6005r3"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6006r4"></a></span><span 
class="cmbtt-10">typedef</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(*</span><span 
class="cmtt-10">func_type</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6007r5"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6008r6"></a></span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">main</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">argc</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">char</span><span 
class="cmtt-10">**</span><span 
class="cmtt-10">argv</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6009r7"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6010r8"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">std</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6011r9"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6012r10"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr32</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6013r11"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr32</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">data32</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6014r12"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6015r13"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">byte_t</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">[100];</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6016r14"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6017r15"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">imm32_t</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">2;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6018r16"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6019r17"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">+=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mov</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">eax</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">dword_ptr</span><span 
class="cmtt-10">[</span><span 
class="cmtt-10">esp</span><span 
class="cmtt-10">+4]);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6020r18"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">+=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">add</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">eax</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6021r19"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">+=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ret</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6022r20"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6023r21"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">func_type</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">func_type</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6024r22"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">len</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">-</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6025r23"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6026r24"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">result</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">argc</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6027r25"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">code</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">length</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">len</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6028r26"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6029r27"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">0;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-6030r28"></a></span><span 
class="cmtt-10">}</span>
   </div>
<!--l. 363--><p class="noindent" >Then, run the following commands on your shell:
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;g++</span><span 
class="cmtt-10">&#x00A0;-DNDEBUG</span><span 
class="cmtt-10">&#x00A0;demo86.cpp</span><span 
class="cmtt-10">&#x00A0;-lerasm</span><span 
class="cmtt-10">&#x00A0;-o</span><span 
class="cmtt-10">&#x00A0;demo86</span>
</td></tr></table>
<!--l. 367--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;./demo86</span></td></tr></table>
<!--l. 368--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;./demo86</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;b</span></td></tr></table>
<!--l. 370--><p class="indent" >
<!--l. 372--><p class="noindent" >Provided the stack is executable in your operating system by default, it will print the
numbers 3 and 5.
   <h5 class="subsubsectionHead"><span class="titlemark">2.2.2   </span> <a 
 id="x1-70002.2.2"></a>64-bit case</h5>
<!--l. 378--><p class="noindent" >First, create a file named <span 
class="cmtt-10">demo64.cpp</span><span class="footnote-mark"><a 
href="manual3.html#fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-7001f2"></a>
with the following contents:
   <!--l. 382--><div class="lstinputlisting">
<a 
 id="x1-7002"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7003r1"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">x64_addr64_data32</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7004r2"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">iostream</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7005r3"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7006r4"></a></span><span 
class="cmbtt-10">typedef</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(*</span><span 
class="cmtt-10">pf_t</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7007r5"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7008r6"></a></span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">main</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">argc</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">char</span><span 
class="cmtt-10">**</span><span 
class="cmtt-10">argv</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7009r7"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7010r8"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">std</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7011r9"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x64</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7012r10"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x64</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr64</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7013r11"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x64</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr64</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">data32</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7014r12"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7015r13"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">byte_t</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">[100];</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7016r14"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7017r15"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">imm32_t</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">2;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7018r16"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7019r17"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">+=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mov</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">rax</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">qword_ptr</span><span 
class="cmtt-10">[</span><span 
class="cmtt-10">rsp</span><span 
class="cmtt-10">+8]);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7020r18"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">+=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">add</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">rax</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7021r19"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">+=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ret</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7022r20"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7023r21"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">pf_t</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">pf_t</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7024r22"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">len</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">-</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">buf</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7025r23"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7026r24"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">result</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">argc</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7027r25"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">code</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">length</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">len</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7028r26"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7029r27"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">0;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-7030r28"></a></span><span 
class="cmtt-10">}</span>
   </div>
<!--l. 383--><p class="noindent" >Then, run the following commands on your shell:
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;g++</span><span 
class="cmtt-10">&#x00A0;-DNDEBUG</span><span 
class="cmtt-10">&#x00A0;demo64.cpp</span><span 
class="cmtt-10">&#x00A0;-lerasm</span><span 
class="cmtt-10">&#x00A0;-o</span><span 
class="cmtt-10">&#x00A0;demo64</span>
</td></tr></table>
<!--l. 385--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;./demo64</span></td></tr></table>
<!--l. 386--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;./demo64</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;b</span></td></tr></table>
<!--l. 388--><p class="indent" >

<!--l. 389--><p class="noindent" >Provided the stack is executable in your operating system by default, it will print the
numbers 3 and 5.
<!--l. 393--><p class="indent" >   The namespace <span 
class="cmtt-10">erasm::x86::addr32::data32</span> contains the actual x86
instruction definitions whose default address and operand sizes are both 32-bit.
Similarly, the namespace <span 
class="cmtt-10">erasm::x64::addr64::data32</span> should be used for IA-64
instructions whose default address and operand sizes are respectively 64-bit
and 32-bit. Currently other default address or operand size modes are not
supported.
   <h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-80002.3"></a>Syntax</h4>
<!--l. 404--><p class="noindent" >In general, the prototype of an ERASM++ instruction is in one of the following
forms:
   <!--l. 406-->
   <div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-8001r1"></a></span>int&#x00A0;MNEMONIC(code_ptr&#x00A0;p);&#x00A0;<br /><span class="label"><a 
 id="x1-8002r2"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-8003r3"></a></span>int&#x00A0;MNEMONIC(code_ptr&#x00A0;p,&#x00A0;<br /><span class="label"><a 
 id="x1-8004r4"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;OP_TYPE&#x00A0;op1);&#x00A0;<br /><span class="label"><a 
 id="x1-8005r5"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-8006r6"></a></span>int&#x00A0;MNEMONIC(code_ptr&#x00A0;p,&#x00A0;<br /><span class="label"><a 
 id="x1-8007r7"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;OP_TYPE&#x00A0;op1,&#x00A0;<br /><span class="label"><a 
 id="x1-8008r8"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;OP_TYPE&#x00A0;op2);&#x00A0;<br /><span class="label"><a 
 id="x1-8009r9"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-8010r10"></a></span>int&#x00A0;MNEMONIC(code_ptr&#x00A0;p,&#x00A0;<br /><span class="label"><a 
 id="x1-8011r11"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;OP_TYPE&#x00A0;op1,&#x00A0;<br /><span class="label"><a 
 id="x1-8012r12"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;OP_TYPE&#x00A0;op2,&#x00A0;<br /><span class="label"><a 
 id="x1-8013r13"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;OP_TYPE&#x00A0;op3);
   </div>
<!--l. 421--><p class="noindent" >where <span 
class="cmtt-10">code_ptr</span> is an alias for the type of pointer to 8-bit unsigned integers on
IA-64/IA-32 architectures.
   <!--l. 424-->
<a 
 id="x1-8014r1"></a>
<a 
 id="x1-8015"></a>
<br /> <div class="caption" 
><span class="id">Listing&#x00A0;1: </span><span  
class="content">Examples of ERASM++ instructions.</span></div><!--tex4ht:label?: x1-8014r2 --><div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-8016r1"></a></span>p&#x00A0;+=&#x00A0;adc&#x00A0;&#x00A0;(p,word_ptr&#x00A0;&#x00A0;[edx&#x00A0;+&#x00A0;esi&#x00A0;<span 
class="cmsy-10">*</span>&#x00A0;_2],ax);&#x00A0;<br /><span class="label"><a 
 id="x1-8017r2"></a></span>p&#x00A0;+=&#x00A0;and_&#x00A0;(p,dword_ptr&#x00A0;[rip&#x00A0;+&#x00A0;0x1000],r12d);&#x00A0;<br /><span class="label"><a 
 id="x1-8018r3"></a></span>p&#x00A0;+=&#x00A0;jmp&#x00A0;&#x00A0;(p,&#x00A0;0x10);&#x00A0;<br /><span class="label"><a 
 id="x1-8019r4"></a></span>p&#x00A0;+=&#x00A0;mov&#x00A0;&#x00A0;(p,byte_ptr&#x00A0;&#x00A0;[eax<span 
class="cmsy-10">*</span>_5],dl);&#x00A0;<br /><span class="label"><a 
 id="x1-8020r5"></a></span>p&#x00A0;+=&#x00A0;rep_movs&#x00A0;(p,dword_ptr.es&#x00A0;[di],dword_ptr.gs&#x00A0;[si]);
   </div>
   <!--l. 431-->
<a 
 id="x1-8021r2"></a>
<a 
 id="x1-8022"></a>
<br /> <div class="caption" 
><span class="id">Listing&#x00A0;2: </span><span  
class="content">The corresponding MASM instructions.</span></div><!--tex4ht:label?: x1-8021r2 --><div class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-8023r1"></a></span><span 
class="cmbx-10">adc</span>&#x00A0;&#x00A0;<span 
class="cmbx-10">WORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;&#x00A0;[<span 
class="cmbx-10">edx</span>&#x00A0;+&#x00A0;<span 
class="cmbx-10">esi</span>&#x00A0;<span 
class="cmsy-10">*</span>&#x00A0;2],<span 
class="cmbx-10">ax</span>&#x00A0;<br /><span class="label"><a 
 id="x1-8024r2"></a></span><span 
class="cmbx-10">and</span>&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[rip&#x00A0;+&#x00A0;0x1000],r12d&#x00A0;<br /><span class="label"><a 
 id="x1-8025r3"></a></span><span 
class="cmbx-10">jmp</span>&#x00A0;&#x00A0;0x10&#x00A0;<br /><span class="label"><a 
 id="x1-8026r4"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;<span 
class="cmbx-10">BYTE</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;&#x00A0;[<span 
class="cmbx-10">eax</span><span 
class="cmsy-10">*</span>5],<span 
class="cmbx-10">dl</span>&#x00A0;<br /><span class="label"><a 
 id="x1-8027r5"></a></span><span 
class="cmbx-10">rep</span>&#x00A0;<span 
class="cmbx-10">movs</span>&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;<span 
class="cmbx-10">es</span>:[<span 
class="cmbx-10">di</span>],<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;<span 
class="cmbx-10">gs</span>:[<span 
class="cmbx-10">si</span>]
   </div>
<!--l. 439--><p class="indent" >   The operational meaning of each instruction is always the same: it encodes the
instruction at the location specified by the first argument, and returns the number of
bytes encoded. If the target address is writable, it is guaranteed that either it
succeeds to encode the instruction, or the instruction is syntactically ill-formed and
the compilation fails. If the destination address is not writable, the behavior is
undefined. In particular, it never throws a (C++) exception.
<!--l. 449--><p class="indent" >   <span 
class="cmbx-10">MNEMONIC </span>is generally one of the instruction mnemonics as defined in the
Intel Instruction Set Reference&#x00A0;<span class="cite">[<a 
href="#Xintel:insn_ref">5</a>]</span>, with each letter converted to lower-case. However,
there are some exceptions:
     <ul class="itemize1">
     <li class="itemize">If the mnemonic is reserved as a keyword in C++ , an underscore is
     appended, as in <span 
class="cmtt-10">int_</span>,<span 
class="cmtt-10">xor_</span>, etc.

     </li>
     <li class="itemize">If the instruction requires a mandatory prefix such as REP, REPZ etc.,
     then the prefix and the mnemonic of the instruction are joined by an
     underscore, as in <span 
class="cmtt-10">repe_scas</span>.
     </li>
     <li class="itemize">Some instructions are ambiguous and cannot be fully specified solely by the
     combination of the mnemonic and operand types. In such a case, we
     resort to rather ad-hoc case-by-case disambiguation schemes such as:
     <!--l. 463-->
     <div class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-8028r1"></a></span>p&#x00A0;+=&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;rep_movs(p,byte_ptr[rdi],byte_ptr[rsi]);&#x00A0;<br /><span class="label"><a 
 id="x1-8029r2"></a></span>p&#x00A0;+=&#x00A0;rexw_rep_movs(p,byte_ptr[rdi],byte_ptr[rsi]);
     </div>
     <!--l. 467--><p class="noindent" >Here, <span 
class="cmtt-10">rep_movs</span> uses <span 
class="cmtt-10">ecx</span> as the count register, while <span 
class="cmtt-10">rexw_rep_movs</span> uses <span 
class="cmtt-10">rcx</span>.
     We are searching for a less ad-hoc disambiguation method, but we would also
     like the form of these instructions to be easily guessable from the definitions in
     Intel Instruction Set Reference&#x00A0;<span class="cite">[<a 
href="#Xintel:insn_ref">5</a>]</span>.</li></ul>
<!--l. 473--><p class="indent" >   <span 
class="cmbx-10">OP</span><span 
class="cmbx-10">_TYPE </span>is the type of an instruction operand which is one of the following
objects:
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">Registers.</span> </dt><dd 
class="description"><span 
class="cmtt-10">dh</span>,<span 
class="cmtt-10">ax</span>,<span 
class="cmtt-10">edx</span>,<span 
class="cmtt-10">xmm0</span>,<span 
class="cmtt-10">st3</span>,<span 
class="cmtt-10">rax</span>,<span 
class="cmtt-10">r8</span>,<span 
class="cmtt-10">r9b</span>,<span 
class="cmtt-10">sil</span>, etc.
     </dd><dt class="description">
<span 
class="cmbx-10">Memory references.</span> </dt><dd 
class="description">Examples:
         <ul class="itemize1">
         <li class="itemize"><span 
class="cmtt-10">byte_ptr</span><span 
class="cmtt-10">&#x00A0;[esp</span><span 
class="cmtt-10">&#x00A0;+</span><span 
class="cmtt-10">&#x00A0;ebp</span><span 
class="cmtt-10">&#x00A0;*</span><span 
class="cmtt-10">&#x00A0;_2</span><span 
class="cmtt-10">&#x00A0;+</span><span 
class="cmtt-10">&#x00A0;4]</span>
         </li>
         <li class="itemize"><span 
class="cmtt-10">dword_ptr</span><span 
class="cmtt-10">&#x00A0;[ebx</span><span 
class="cmtt-10">&#x00A0;*</span><span 
class="cmtt-10">&#x00A0;_8</span><span 
class="cmtt-10">&#x00A0;+</span><span 
class="cmtt-10">&#x00A0;_4]</span>
         </li>
         <li class="itemize"><span 
class="cmtt-10">xmmword_ptr</span><span 
class="cmtt-10">&#x00A0;.</span><span 
class="cmtt-10">&#x00A0;gs[bx+di]</span></li></ul>
     </dd><dt class="description">
<span 
class="cmbx-10">Immediates.</span> </dt><dd 
class="description"><span 
class="cmtt-10">(int32_t)0</span>,<span 
class="cmtt-10">(int8_t)1</span>,<span 
class="cmtt-10">_1</span>,<span 
class="cmtt-10">_2</span>, etc.</dd></dl>
<!--l. 487--><p class="indent" >   The static constants <span 
class="cmtt-10">_0</span>-<span 
class="cmtt-10">_9</span> can be used as a shorthand for small 8-bit integers. By
nature, assembly instructions are quite picky about the exact operand types, and it is
very often the case that either using static constants or casting explicitly is required
to avoid the ambiguity.
<!--l. 493--><p class="indent" >   Note that the scale coefficient of the index register (e.g. <span 
class="cmtt-10">_2</span> in the expression
<span 
class="cmtt-10">[edx</span><span 
class="cmtt-10">&#x00A0;+</span><span 
class="cmtt-10">&#x00A0;_2</span><span 
class="cmtt-10">&#x00A0;*</span><span 
class="cmtt-10">&#x00A0;ecx]</span>) must be specified with the static constants <span 
class="cmtt-10">_1</span> - <span 
class="cmtt-10">_9</span>. This
inconvenience results from the need to compute the necessary data statically, and will
not change.

<!--l. 498--><p class="indent" >   Please see Intel Instruction Set Reference&#x00A0;<span class="cite">[<a 
href="#Xintel:insn_ref">5</a>]</span> for the details of instruction
definitions.
<!--l. 501--><p class="indent" >   For the examples of syntactically valid instructions, see
     <ul class="itemize1">
     <li class="itemize"><span 
class="cmtt-10">src/erasm/x64_assembler_manual_test.cpp</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">src/erasm/x64_assembler_auto_test.cpp</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">src/erasm/x86_assembler_manual_test.cpp</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">src/erasm/x86_assembler_auto_test.cpp</span></li></ul>
<!--l. 510--><p class="indent" >   For the examples of ill-formed instructions, see
     <ul class="itemize1">
     <li class="itemize"><span 
class="cmtt-10">src/erasm/x64_assembler_illegal_code.cpp</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">src/erasm/x86_assembler_illegal_code.cpp</span></li></ul>
<!--l. 517--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-90002.4"></a>Performance</h4>
<!--l. 519--><p class="noindent" >If all the required functions are inlined(see below), ERASM++ instructions will be
compiled to a series of simple memory copy instructions with no external
references(except possibly the reference to the execution stack).
<!--l. 524--><p class="indent" >   Let us give an example. On a 32-bit Pentium machine, g++ 4.6.1 compiles (with
the option -O3 to ensure inlining) the following code:
   <!--l. 527-->
   <div class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-9001r1"></a></span>inline&#x00A0;int&#x00A0;adc&#x00A0;(code_ptr&#x00A0;p,&#x00A0;<br /><span class="label"><a 
 id="x1-9002r2"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;ByteReg86&#x00A0;&amp;&#x00A0;op1,&#x00A0;<br /><span class="label"><a 
 id="x1-9003r3"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;BytePtr86&#x00A0;&amp;&#x00A0;op2)&#x00A0;<br /><span class="label"><a 
 id="x1-9004r4"></a></span><span 
class="cmsy-10">{</span>&#x00A0;<br /><span class="label"><a 
 id="x1-9005r5"></a></span>&#x00A0;&#x00A0;//&#x00A0;details&#x00A0;omitted&#x00A0;<br /><span class="label"><a 
 id="x1-9006r6"></a></span><span 
class="cmsy-10">}</span>&#x00A0;<br /><span class="label"><a 
 id="x1-9007r7"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-9008r8"></a></span>extern&#x00A0;&#8221;C&#8221;&#x00A0;&#x00A0;int&#x00A0;code_test(code_ptr&#x00A0;p)&#x00A0;<br /><span class="label"><a 
 id="x1-9009r9"></a></span><span 
class="cmsy-10">{</span>&#x00A0;<span 
class="cmbx-10">return</span>&#x00A0;adc(p&#x00A0;,cl,byte_ptr&#x00A0;[eax+ebp<span 
class="cmsy-10">*</span>_4+12345678]);&#x00A0;&#x00A0;<span 
class="cmsy-10">}</span>
   </div>
<!--l. 538--><p class="indent" >   to: <!--l. 539-->
   <div class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-9010r1"></a></span>_code_test:&#x00A0;<br /><span class="label"><a 
 id="x1-9011r2"></a></span><span 
class="cmbx-10">sub</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">esp</span>,&#x00A0;32&#x00A0;<br /><span class="label"><a 
 id="x1-9012r3"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">eax</span>,&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">esp</span>+36]&#x00A0;<br /><span class="label"><a 
 id="x1-9013r4"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">BYTE</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">esp</span>+5],&#x00A0;<span 
class="cmsy-10">-</span>88&#x00A0;<br /><span class="label"><a 
 id="x1-9014r5"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">esp</span>+6],&#x00A0;12345678&#x00A0;<br /><span class="label"><a 
 id="x1-9015r6"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">BYTE</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">esp</span>+4],&#x00A0;<span 
class="cmsy-10">-</span>116&#x00A0;<br /><span class="label"><a 
 id="x1-9016r7"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">BYTE</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">eax</span>],&#x00A0;103&#x00A0;<br /><span class="label"><a 
 id="x1-9017r8"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">BYTE</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">eax</span>+1],&#x00A0;18&#x00A0;<br /><span class="label"><a 
 id="x1-9018r9"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">edx</span>,&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">esp</span>+4]&#x00A0;<br /><span class="label"><a 
 id="x1-9019r10"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">eax</span>+2],&#x00A0;<span 
class="cmbx-10">edx</span>&#x00A0;<br /><span class="label"><a 
 id="x1-9020r11"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">edx</span>,&#x00A0;<span 
class="cmbx-10">DWORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">esp</span>+8]&#x00A0;<br /><span class="label"><a 
 id="x1-9021r12"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">WORD</span>&#x00A0;<span 
class="cmbx-10">PTR</span>&#x00A0;[<span 
class="cmbx-10">eax</span>+6],&#x00A0;<span 
class="cmbx-10">dx</span>&#x00A0;<br /><span class="label"><a 
 id="x1-9022r13"></a></span><span 
class="cmbx-10">mov</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">eax</span>,&#x00A0;8&#x00A0;<br /><span class="label"><a 
 id="x1-9023r14"></a></span><span 
class="cmbx-10">add</span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmbx-10">esp</span>,&#x00A0;32&#x00A0;<br /><span class="label"><a 
 id="x1-9024r15"></a></span><span 
class="cmbx-10">ret</span>
   </div>
<!--l. 557--><p class="indent" >   Although the above code may not be the fastest possible, we observe the following
very nice properties:
<!--l. 560--><p class="indent" >

     <dl class="description"><dt class="description">
<span 
class="cmbx-10">No branches.</span> </dt><dd 
class="description">Conditional or not, branches always consume precious processor
     resources&#x00A0;<span class="cite">[<a 
href="#Xintel:opt_ref">4</a>]</span>, so their absence is always beneficial for performance reasons.
     Furthermore, in kernel spaces, there is a greater risk that the target address
     is  not  accessible  at  all  (e.g.  the  corresponding  section  may  have  been
     swapped out and the code runs in a high priority mode.)
     </dd><dt class="description">
<span 
class="cmbx-10">No external references.</span> </dt><dd 
class="description">This is also a very good property for the similar
     reasons. See&#x00A0;<span class="cite">[<a 
href="#Xintel:opt_ref">4</a>]</span> for the details.
     </dd></dl>
<!--l. 573--><p class="indent" >   Although there are strong arguments against introducing C++ code into the
operating system kernel spaces&#x00A0;<span class="cite">[<a 
href="#Xlinux:cpp_kernel">1</a>]</span><span class="cite">[<a 
href="#Xms:cpp_kernel">6</a>]</span>, it should be clear that ERASM++ <span 
class="cmti-10">per se </span>does
not possess any such weakness that makes it hard to adopt C++ code into the kernel
space.
<!--l. 579--><p class="indent" >   Currently the main ERASM++ encoder functions are all compiled in a seperate
module for the sake of compiletime performance.
<!--l. 582--><p class="indent" >   See <span 
class="cmtt-10">src/test_asm_performance.cpp</span> for how to inline the required functions.
<!--l. 585--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-100002.5"></a>Limitations</h4>
<!--l. 588--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-110002.5"></a><span 
class="cmbx-10">Compile-time Performance</span></span>
   By far the biggest limitation of ERASM++ is its compile-time resource usage.
Because of the heavy use of template metaprogramming techniques, the
exact compile-time behaviour greatly varies from one compiler version to
another.
<!--l. 596--><p class="indent" >   For example, while g++-4.5.4 compiles a source file which consists of about 2500
instructions just fine with memory usage <span 
class="cmsy-10">~</span>500MB, g++-4.6.1 consumes all
available user-space (typically up to 2GB in 32-bit systems) and eventually gives
up.
<!--l. 601--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-120002.5"></a><span 
class="cmbx-10">Error Messages</span></span>
   Another disadvantage of using ERASM++ is its often cryptic error messages.
This is inherently an implementation-dependant problem, and is impossible to solve
generally. Current implementation only makes some effort to increase readability for
g++.
<!--l. 609--><p class="indent" >   Here&#8217;s an example (manually formatted) error message from g++. Given the code
<!--l. 611-->
   <div class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-12001r1"></a></span>cvtpd2pi(p,mm1,xmmword_ptr[rax+&#x00A0;rsp<span 
class="cmsy-10">*</span>_2]);

   </div>
<!--l. 614--><p class="indent" >   g++-4.6.1 prints the following message: <!--l. 615-->
   <div class="lstlisting" id="listing-8"><span class="label"><a 
 id="x1-12002r1"></a></span>./erasm/meta_prelude_core.hpp:829:128:&#x00A0;<br /><span class="label"><a 
 id="x1-12003r2"></a></span>error:&#x00A0;no&#x00A0;type&#x00A0;named&#x00A0;&#8217;result&#8217;&#x00A0;in&#x00A0;<br /><span class="label"><a 
 id="x1-12004r3"></a></span>&#8217;struct&#x00A0;erasm::prelude::<span 
class="cmbx-10">eval</span><span 
class="cmmi-10">&#x003C;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-12005r4"></a></span>erasm::prelude::if_<span 
class="cmmi-10">&#x003C;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-12006r5"></a></span>&#x00A0;erasm::prelude::error<span 
class="cmmi-10">&#x003C;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-12007r6"></a></span>&#x00A0;&#x00A0;erasm::x64::&#x00A0;<br /><span class="label"><a 
 id="x1-12008r7"></a></span>&#x00A0;&#x00A0;<span class="underline">Error_ESP_and_RSP_cannot_be_used_as_the_index_register</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12009r8"></a></span>&#x00A0;&#x00A0;&#x00A0;erasm::prelude::Term<span 
class="cmmi-10">&#x003C;</span>erasm::prelude::Int<span 
class="cmmi-10">&#x003C;</span>4<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12010r9"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;erasm::prelude::<span 
class="cmbx-10">times</span><span 
class="cmmi-10">&#x003C;</span>erasm::prelude::Int<span 
class="cmmi-10">&#x003C;</span>2<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12011r10"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;erasm::prelude::Int<span 
class="cmmi-10">&#x003C;</span>1<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12012r11"></a></span>&#x00A0;&#x00A0;&#x00A0;erasm::prelude::Term<span 
class="cmmi-10">&#x003C;</span>erasm::prelude::Int<span 
class="cmmi-10">&#x003C;</span>0<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12013r12"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;erasm::prelude::Int<span 
class="cmmi-10">&#x003C;</span>1<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12014r13"></a></span>&#x00A0;&#x00A0;&#x00A0;void,&#x00A0;void<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12015r14"></a></span>&#x00A0;erasm::x64::PtrRex<span 
class="cmmi-10">&#x003C;</span>erasm::x64::XmmWord<span 
class="cmmi-10">&#x003E;</span>,&#x00A0;<br /><span class="label"><a 
 id="x1-12016r15"></a></span>&#x00A0;erasm::x64::PtrNoRex<span 
class="cmmi-10">&#x003C;</span>erasm::x64::XmmWord<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<span 
class="cmmi-10">&#x003E;</span>&#8217;&#x00A0;<br /><span class="label"><a 
 id="x1-12017r16"></a></span>...
   </div>
<!--l. 633--><p class="indent" >   Note the underlined identifier above, which correctly spots the problem.
<!--l. 635--><p class="indent" >   Unfortunately, Microsoft&#8217;s <span 
class="cmtt-10">cl.exe</span> tries to outsmart our effort and emits more
obscure error messages.
<!--l. 638--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-130002.5"></a><span 
class="cmbx-10">Labels</span></span>
   We have not implemented labels yet. It is necessary to maintain code positions
manually if back-patching or relocations are required.
<!--l. 644--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-140002.5"></a><span 
class="cmbx-10">Standard Conformance</span></span>
   ERASM++ declares static constants <span 
class="cmtt-10">_1</span>,<span 
class="cmtt-10">_2</span>, etc. in one of its namespaces. This is
potentially problematic as the standard specifies that any identifier that
begins with an underscore is reserved for the implementation in the global
namespace.
<!--l. 652--><p class="indent" >   Finally, ERASM++ cannot be fully standard conformant because it must be
dependent on the platform-specific data representations. For example, the Intel
64/IA-32 related code relies on the availability of 8-, 16-, 32-, and 64-bit integers, the
availability of <span 
class="cmtt-10">#pragma</span><span 
class="cmtt-10">&#x00A0;pack</span> compiler directive, and the little-endianess of the
platform. However, if the compiler does support the platform, there should be no
problem compiling ERASM++ as long as the compiler is reasonably standard
conformant.
<!--l. 661--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-150003"></a>GenericDsm</h3>
<!--l. 664--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-160003.1"></a>Overview</h4>
<!--l. 667--><p class="noindent" >GenericDsm is a fast and generic instruction decoder library that supports
pattern-match like interface which resembles that of modern functional languages
such as Haskell. Features include:
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">Genericity.</span> </dt><dd 
class="description">Since the decoder function is a template function parametrized by
     the user-supplied set of actions, it can adapt to any kind of needs without
     sacrificing performance.

     </dd><dt class="description">
<span 
class="cmbx-10">Speed.</span> </dt><dd 
class="description">Genericity allows specializing to one&#8217;s custom needs. In some cases, this
     leads to an instruction decoder which is more than an order of magnitude
     faster than non-generic instruction decoder libraries such as libopcodes (a
     library which is ubiquitous in GNU/Linux systems).
     </dd><dt class="description">
<span 
class="cmbx-10">Pattern-matching against instructions.</span> </dt><dd 
class="description">Not only does it lead to cleaner
     code, it also contributes to reducing common overheads in many existing
     disassembler libraries. For example, it allows using static compile-time
     predicates on a set of instructions and operands, avoiding the common
     runtime tests in C-based libraries.
     </dd><dt class="description">
<span 
class="cmbx-10">No dependence on runtime system.</span> </dt><dd 
class="description">Just   like   ERASM++,   the   main
     decoder function in GenericDsm itself does not depend on other libraries
     including  STL  or  even  the  C  runtime  libraries,  except  some  Boost&#8217;s
     header-only libraries. Furthermore, it does not throw exceptions, rely on
     vtables, or allocate memory outside the stack. This allows GenericDsm to
     be used in most demanding circumstances.
     </dd><dt class="description">
<span 
class="cmbx-10">Reentrant.</span> </dt><dd 
class="description">Since the decoder function itself only uses local stack-allocated
     variables, it is fully reentrant and thread-safe as long as the user-supplied
     actions are. (Assuming the decoded instructions are constant, of course.)
     </dd></dl>
<!--l. 702--><p class="indent" >   Only Intel 64/IA-32 architectures are supported. Also, there is a considerable
compile-time overhead using GenericDsm as is common in all C++ programs with
heavy use of metaprogramming and inlining.
<!--l. 707--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-170003.2"></a>Basic Examples</h4>
<!--l. 710--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">3.2.1   </span> <a 
 id="x1-180003.2.1"></a>32-bit case</h5>
<!--l. 713--><p class="noindent" >First, create a file named <span 
class="cmtt-10">dsm86.cpp</span><span class="footnote-mark"><a 
href="manual4.html#fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-18001f3"></a>
with the following contents:
   <!--l. 716--><div class="lstinputlisting">
<a 
 id="x1-18002"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18003r1"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">dsm_x86_util</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18004r2"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">dsm_x86</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18005r3"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">faststream</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18006r4"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18007r5"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">std</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18008r6"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18009r7"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr32</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">data32</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18010r8"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18011r9"></a></span><span 
class="cmbtt-10">struct</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyDsm</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">public</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">SimpleDsm</span><span 
class="cmtt-10">&#x003C;&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18012r10"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18013r11"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyDsm</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">start</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">ostream</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18014r12"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">SimpleDsm</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">start</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18015r13"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18016r14"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18017r15"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">SimpleDsm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18018r16"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18019r17"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action_result_type</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18020r18"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Ret</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18021r19"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18022r20"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">()</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Ret</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">mnemonic</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18023r21"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">finish</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18024r22"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18025r23"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18026r24"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">template</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmbtt-10">class</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Op</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18027r25"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action_result_type</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18028r26"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Push</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Op</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">op</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18029r27"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18030r28"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">()</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Push</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">mnemonic</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18031r29"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">op</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18032r30"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">next</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18033r31"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18034r32"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18035r33"></a></span><span 
class="cmtt-10">};</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18036r34"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18037r35"></a></span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18038r36"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18039r37"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">+1;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18040r38"></a></span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18041r39"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18042r40"></a></span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">main</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">argc</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">char</span><span 
class="cmtt-10">**</span><span 
class="cmtt-10">argv</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18043r41"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18044r42"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18045r43"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyDsm</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mydsm</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18046r44"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18047r45"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">end</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">decode</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">mydsm</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18048r46"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18049r47"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">if</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">mydsm</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">failed</span><span 
class="cmtt-10">())</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18050r48"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Disassembly</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">failed</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">at</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18051r49"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">hex</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">void</span><span 
class="cmtt-10">*)</span><span 
class="cmtt-10">end</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18052r50"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">else</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18053r51"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Disassembly</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">ended</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">at</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18054r52"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">hex</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">void</span><span 
class="cmtt-10">*)</span><span 
class="cmtt-10">end</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18055r53"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18056r54"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">0;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18057r55"></a></span><span 
class="cmtt-10">}</span>

   </div>
<!--l. 718--><p class="indent" >   Then, run the following commands on your shell:
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;g++</span><span 
class="cmtt-10">&#x00A0;-DNDEBUG</span><span 
class="cmtt-10">&#x00A0;-O3</span><span 
class="cmtt-10">&#x00A0;dsm86.cpp</span><span 
class="cmtt-10">&#x00A0;-lerasm_dsm</span><span 
class="cmtt-10">&#x00A0;-o</span><span 
class="cmtt-10">&#x00A0;dsm86</span>
</td></tr></table>
<!--l. 722--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;./dsm86</span></td></tr></table>
<!--l. 724--><p class="indent" >
<!--l. 726--><p class="indent" >   On a 32-bit system, the output will look like the following:
   <!--l. 728--><div class="lstinputlisting">
<a 
 id="x1-18061"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18062r1"></a></span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">push</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ebp</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18063r2"></a></span><span 
class="cmtt-10">89</span><span 
class="cmtt-10">e5</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048681</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">2</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mov</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ebp</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">esp</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18064r3"></a></span><span 
class="cmtt-10">8</span><span 
class="cmtt-10">b4508</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048683</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">3</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mov</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">eax</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">DWORD</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">PTR</span><span 
class="cmtt-10">[</span><span 
class="cmtt-10">ebp</span><span 
class="cmtt-10">+0</span><span 
class="cmtt-10">x8</span><span 
class="cmtt-10">]</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18065r4"></a></span><span 
class="cmtt-10">83</span><span 
class="cmtt-10">c001</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048686</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">3</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">add</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">eax</span><span 
class="cmtt-10">,0</span><span 
class="cmtt-10">x1</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18066r5"></a></span><span 
class="cmtt-10">5</span><span 
class="cmtt-10">d</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048689</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">1</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">pop</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ebp</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18067r6"></a></span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">ret</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-18068r7"></a></span><span 
class="cmtt-10">Disassembly</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ended</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">at</span><span 
class="cmtt-10">:0</span><span 
class="cmtt-10">x804868b</span>
   </div>
   <h5 class="subsubsectionHead"><span class="titlemark">3.2.2   </span> <a 
 id="x1-190003.2.2"></a>64-bit case</h5>
<!--l. 733--><p class="noindent" >First, create a file named <span 
class="cmtt-10">dsm64.cpp</span> with the following contents:
   <!--l. 735--><div class="lstinputlisting">
<a 
 id="x1-19001"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19002r1"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">dsm_x64_util</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19003r2"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">dsm_x64</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19004r3"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">faststream</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19005r4"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19006r5"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">std</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19007r6"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x64</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19008r7"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x64</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr64</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">data32</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19009r8"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19010r9"></a></span><span 
class="cmbtt-10">struct</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyDsm</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">public</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">SimpleDsm</span><span 
class="cmtt-10">&#x003C;&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19011r10"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19012r11"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyDsm</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">start</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">ostream</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19013r12"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">SimpleDsm</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">start</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19014r13"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19015r14"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19016r15"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">SimpleDsm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19017r16"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19018r17"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action_result_type</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19019r18"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Ret</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19020r19"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19021r20"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">()</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Ret</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">mnemonic</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19022r21"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">finish</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19023r22"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19024r23"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19025r24"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">template</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmbtt-10">class</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Op</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19026r25"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action_result_type</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19027r26"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Push</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Op</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">op</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19028r27"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19029r28"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">os</span><span 
class="cmtt-10">()</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Push</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">mnemonic</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19030r29"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">op</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19031r30"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">next</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19032r31"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19033r32"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19034r33"></a></span><span 
class="cmtt-10">};</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19035r34"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19036r35"></a></span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19037r36"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19038r37"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">x</span><span 
class="cmtt-10">+1;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19039r38"></a></span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19040r39"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19041r40"></a></span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">main</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">int</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">argc</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">char</span><span 
class="cmtt-10">**</span><span 
class="cmtt-10">argv</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19042r41"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19043r42"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">f</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19044r43"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyDsm</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mydsm</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19045r44"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19046r45"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">end</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">=</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">decode</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">p</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">mydsm</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19047r46"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19048r47"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">if</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">mydsm</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">failed</span><span 
class="cmtt-10">())</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19049r48"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Disassembly</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">failed</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">at</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19050r49"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">hex</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">void</span><span 
class="cmtt-10">*)</span><span 
class="cmtt-10">end</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19051r50"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">else</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19052r51"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">cout</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">Disassembly</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">ended</span><span 
class="cmtt-10">&#x2423;</span><span 
class="cmtt-10">at</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">"</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19053r52"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">hex</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">void</span><span 
class="cmtt-10">*)</span><span 
class="cmtt-10">end</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">endl</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19054r53"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19055r54"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">0;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19056r55"></a></span><span 
class="cmtt-10">}</span>
   </div>
<!--l. 737--><p class="indent" >   Then, run the following commands on your shell:
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;g++</span><span 
class="cmtt-10">&#x00A0;-DNDEBUG</span><span 
class="cmtt-10">&#x00A0;-O3</span><span 
class="cmtt-10">&#x00A0;dsm64.cpp</span><span 
class="cmtt-10">&#x00A0;-lerasm_dsm</span><span 
class="cmtt-10">&#x00A0;-o</span><span 
class="cmtt-10">&#x00A0;dsm64</span>
</td></tr></table>
<!--l. 741--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><span 
class="cmtt-10">&#x00A0;$</span><span 
class="cmtt-10">&#x00A0;./dsm64</span></td></tr></table>
<!--l. 743--><p class="indent" >
<!--l. 745--><p class="indent" >   On a 64-bit system, the output will look like the following:
   <!--l. 747--><div class="lstinputlisting">
<a 
 id="x1-19060"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19061r1"></a></span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">push</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">rbp</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19062r2"></a></span><span 
class="cmtt-10">89</span><span 
class="cmtt-10">e5</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048651</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">2</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mov</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ebp</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">esp</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19063r3"></a></span><span 
class="cmtt-10">8</span><span 
class="cmtt-10">b4508</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048653</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">3</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">mov</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">eax</span><span 
class="cmtt-10">,</span><span 
class="cmtt-10">DWORD</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">PTR</span><span 
class="cmtt-10">[</span><span 
class="cmtt-10">rbp</span><span 
class="cmtt-10">+0</span><span 
class="cmtt-10">x8</span><span 
class="cmtt-10">]</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19064r4"></a></span><span 
class="cmtt-10">83</span><span 
class="cmtt-10">c001</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048656</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">3</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">add</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">eax</span><span 
class="cmtt-10">,0</span><span 
class="cmtt-10">x1</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19065r5"></a></span><span 
class="cmtt-10">5</span><span 
class="cmtt-10">d</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">08048659</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">1</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">pop</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">rbp</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19066r6"></a></span><span 
class="cmtt-10">Matched</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">ret</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-19067r7"></a></span><span 
class="cmtt-10">Disassembly</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">ended</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">at</span><span 
class="cmtt-10">:0</span><span 
class="cmtt-10">x804865b</span>
   </div>
<!--l. 749--><p class="indent" >   Note that the directive <span 
class="cmtt-10">using</span><span 
class="cmtt-10">&#x00A0;SimpleDsm::action</span> in those two examples is
mandatory unless your compiler employs a non-standard name resolution
algorithm.

<!--l. 754--><p class="indent" >   As we will discuss shortly, the above apparently quite simple examples already
give <span 
class="cmti-10">very fast </span>disassemblers. Indeed, they are more than four times as fast as
libopcodes based disassemblers on one of our systems (Windows 7 32-bit, Pentium
Dual E2220 2.40GHz) <span 
class="cmti-10">including IO</span>.
<!--l. 760--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.3   </span> <a 
 id="x1-200003.3"></a>Overview of the API</h4>
<!--l. 763--><p class="noindent" >In this section, we outline the current library interface. Note that the current
implementation is still in its alpha stage, and the interface <span 
class="cmti-10">will </span>change as we receive
feedbacks from users/testers.
<!--l. 767--><p class="indent" >   Here is the prototypes of the two most important functions in the library:
<!--l. 768-->
   <div class="lstlisting" id="listing-9"><span class="label"><a 
 id="x1-20001r1"></a></span>namespace&#x00A0;erasm&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;namespace&#x00A0;x64&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20002r2"></a></span>namespace&#x00A0;addr64&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;namespace&#x00A0;data32&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20003r3"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20004r4"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;template<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Action<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20005r5"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;const_code_ptr&#x00A0;<br /><span class="label"><a 
 id="x1-20006r6"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;decode(const_code_ptr&#x00A0;decode_start,&#x00A0;<br /><span class="label"><a 
 id="x1-20007r7"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Action&#x00A0;&amp;&#x00A0;action);&#x00A0;<br /><span class="label"><a 
 id="x1-20008r8"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20009r9"></a></span><span 
class="cmsy-10">}}}}</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20010r10"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20011r11"></a></span>namespace&#x00A0;erasm&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;namespace&#x00A0;x86&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20012r12"></a></span>namespace&#x00A0;addr32&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;namespace&#x00A0;data32&#x00A0;<span 
class="cmsy-10">{</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20013r13"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20014r14"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;template<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Action<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20015r15"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;const_code_ptr&#x00A0;<br /><span class="label"><a 
 id="x1-20016r16"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;decode(const_code_ptr&#x00A0;decode_start,&#x00A0;<br /><span class="label"><a 
 id="x1-20017r17"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Action&#x00A0;&amp;&#x00A0;action);&#x00A0;<br /><span class="label"><a 
 id="x1-20018r18"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20019r19"></a></span><span 
class="cmsy-10">}}}}</span>
   </div>
<!--l. 790--><p class="indent" >   The functions take two arguments, the first of which denotes the address at which
the disassembly starts, and the second what action it should take for each decoded
instruction. It returns the address the decoding has ended.
<!--l. 794--><p class="indent" >   To describe the condition under which the class <span 
class="cmbx-10">Action </span>is to be a valid argument
type, recall the prototype of an <span 
class="cmmi-10">n</span>-ary (<span 
class="cmmi-10">n </span>= 0<span 
class="cmmi-10">,</span>1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span>3) ERASM++ instruction:
<!--l. 797-->
   <div class="lstlisting" id="listing-10"><span class="label"><a 
 id="x1-20020r1"></a></span>int&#x00A0;<span 
class="cmti-10">mnemonic</span>(code_ptr_type&#x00A0;p,&#x00A0;<br /><span class="label"><a 
 id="x1-20021r2"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmti-10">OP</span>_<span 
class="cmti-10">TYPE</span><sub><span 
class="cmr-7">0</span></sub>&#x00A0;<span 
class="cmti-10">op</span><sub><span 
class="cmr-7">0</span></sub>,&#x00A0;<br /><span class="label"><a 
 id="x1-20022r3"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;..&#x00A0;,&#x00A0;<br /><span class="label"><a 
 id="x1-20023r4"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;<span 
class="cmti-10">OP</span>_<span 
class="cmti-10">TYPE</span><sub><span 
class="cmmi-7">n</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub>&#x00A0;<span 
class="cmti-10">op</span><sub><span 
class="cmmi-7">n</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub>);
   </div>
<!--l. 804--><p class="indent" >   For each <span 
class="cmti-10">mnemonic</span>, we define the corresponding class <span 
class="cmti-10">Mnemonic</span>, a class whose
name is the same as <span 
class="cmti-10">mnemonic </span>except the first letter is upper-case. The class
<span 
class="cmti-10">Mnemonic </span>is a non-virtual subclass of <span 
class="cmtt-10">InstructionData</span>, which we will explain
later.
<!--l. 810--><p class="indent" >   Now, for an object <span 
class="cmtt-10">act</span> of type <span 
class="cmtt-10">Action</span> to be a valid argument for <span 
class="cmtt-10">decode</span>, the
following expression must be valid for any object <span 
class="cmtt-10">insn</span> of type <span 
class="cmti-10">Mnemonic</span>:
   <!--l. 814-->
   <div class="lstlisting" id="listing-11"><span class="label"><a 
 id="x1-20024r1"></a></span>std::pair<span 
class="cmmi-10">&#x003C;</span>const_code_ptr,ACTION_TYPE<span 
class="cmmi-10">&#x003E;</span>&#x00A0;ret&#x00A0;<br /><span class="label"><a 
 id="x1-20025r2"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;=&#x00A0;act.action(insn,<span 
class="cmmi-10">op</span><sub><span 
class="cmr-7">0</span></sub>,..,<span 
class="cmmi-10">op</span><sub><span 
class="cmmi-7">n</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub>);
   </div>
<!--l. 818--><p class="indent" >   Here, <span 
class="cmtt-10">ret.second</span> is either:
     <dl class="description"><dt class="description">
<span 
class="cmtt-10">ACTION_FINISH</span> </dt><dd 
class="description">, to instruct the function to return (with value <span 
class="cmtt-10">ret.first</span>), or
     </dd><dt class="description">
<span 
class="cmtt-10">ACTION_CONTINUE</span> </dt><dd 
class="description">, to instruct the function to continue decoding at the address
     specified by <span 
class="cmtt-10">ret.first</span>.</dd></dl>

<!--l. 827--><p class="noindent" >Furthermore, the following expression must be valid: <!--l. 828-->
   <div class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-20026r1"></a></span>const_code_ptr&#x00A0;ret&#x00A0;=&#x00A0;act.error(decode_data);
   </div>
<!--l. 831--><p class="noindent" >where <span 
class="cmtt-10">decode_data</span> is an object of class <span 
class="cmtt-10">InstructionData</span> and contains the location
of decode error.
<!--l. 834--><p class="indent" >   The following prototype illustrates the sufficient condition to be the type of a
valid argument for <span 
class="cmtt-10">decode</span>.
   <!--l. 837-->
   <div class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-20027r1"></a></span>typedef&#x00A0;std::pair<span 
class="cmmi-10">&#x003C;</span>const_code_ptr,ACTION_TYPE<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20028r2"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;action_result_type;&#x00A0;<br /><span class="label"><a 
 id="x1-20029r3"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20030r4"></a></span>struct&#x00A0;Action&#x00A0;<br /><span class="label"><a 
 id="x1-20031r5"></a></span><span 
class="cmsy-10">{</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20032r6"></a></span>&#x00A0;&#x00A0;&#x00A0;template<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Insn<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20033r7"></a></span>&#x00A0;&#x00A0;&#x00A0;action_result_type&#x00A0;<br /><span class="label"><a 
 id="x1-20034r8"></a></span>&#x00A0;&#x00A0;&#x00A0;action(const&#x00A0;Insn&amp;&#x00A0;insn);&#x00A0;<br /><span class="label"><a 
 id="x1-20035r9"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20036r10"></a></span>&#x00A0;&#x00A0;&#x00A0;template<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Insn,class&#x00A0;Op1<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20037r11"></a></span>&#x00A0;&#x00A0;&#x00A0;action_result_type&#x00A0;<br /><span class="label"><a 
 id="x1-20038r12"></a></span>&#x00A0;&#x00A0;&#x00A0;action(const&#x00A0;Insn&amp;&#x00A0;insn,&#x00A0;<br /><span class="label"><a 
 id="x1-20039r13"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;Op1&amp;&#x00A0;op1);&#x00A0;<br /><span class="label"><a 
 id="x1-20040r14"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20041r15"></a></span>&#x00A0;&#x00A0;&#x00A0;template<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Insn,class&#x00A0;Op1,class&#x00A0;Op2<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20042r16"></a></span>&#x00A0;&#x00A0;&#x00A0;action_result_type&#x00A0;<br /><span class="label"><a 
 id="x1-20043r17"></a></span>&#x00A0;&#x00A0;&#x00A0;action(const&#x00A0;Insn&amp;&#x00A0;insn,&#x00A0;<br /><span class="label"><a 
 id="x1-20044r18"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;Op1&amp;&#x00A0;op1,&#x00A0;<br /><span class="label"><a 
 id="x1-20045r19"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;Op2&amp;&#x00A0;op2);&#x00A0;<br /><span class="label"><a 
 id="x1-20046r20"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20047r21"></a></span>&#x00A0;&#x00A0;&#x00A0;template<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Insn,class&#x00A0;Op1,class&#x00A0;Op2,class&#x00A0;Op3<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20048r22"></a></span>&#x00A0;&#x00A0;&#x00A0;action_result_type&#x00A0;<br /><span class="label"><a 
 id="x1-20049r23"></a></span>&#x00A0;&#x00A0;&#x00A0;action(const&#x00A0;Insn&amp;&#x00A0;insn,&#x00A0;<br /><span class="label"><a 
 id="x1-20050r24"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;Op1&amp;&#x00A0;op1,&#x00A0;<br /><span class="label"><a 
 id="x1-20051r25"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;Op2&amp;&#x00A0;op2,&#x00A0;<br /><span class="label"><a 
 id="x1-20052r26"></a></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;Op3&amp;&#x00A0;op3);&#x00A0;<br /><span class="label"><a 
 id="x1-20053r27"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20054r28"></a></span>&#x00A0;&#x00A0;&#x00A0;const_code_ptr_type&#x00A0;<br /><span class="label"><a 
 id="x1-20055r29"></a></span>&#x00A0;&#x00A0;&#x00A0;error(const&#x00A0;InstructionData&amp;&#x00A0;params);&#x00A0;<br /><span class="label"><a 
 id="x1-20056r30"></a></span>&#x00A0;<br /><span class="label"><a 
 id="x1-20057r31"></a></span><span 
class="cmsy-10">}</span>;
   </div>
<!--l. 871--><p class="indent" >   For example, the following code defines a simple instruction counter that only
considers <span 
class="cmtt-10">ret</span> and <span 
class="cmtt-10">jmp</span> instructions:
   <!--l. 874--><div class="lstinputlisting">
<a 
 id="x1-20058"></a>
   <span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20059r1"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">dsm_x86_util</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20060r2"></a></span><span 
class="cmbtt-10">#</span><span 
class="cmbtt-10">include</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">/</span><span 
class="cmtt-10">dsm_x86</span><span 
class="cmtt-10">.</span><span 
class="cmtt-10">hpp</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20061r3"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20062r4"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20063r5"></a></span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">namespace</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">erasm</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">x86</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">addr32</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">data32</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20064r6"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20065r7"></a></span><span 
class="cmbtt-10">struct</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">MyCounter</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">public</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">InstructionCounter</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20066r8"></a></span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20067r9"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">InstructionCounter</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">const_code_ptr</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">start</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20068r10"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">InstructionCounter</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">start</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20069r11"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20070r12"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20071r13"></a></span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">//</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">Let</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">the</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">base</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">class</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">handle</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">the</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">default</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">cases</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20072r14"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">InstructionCounter</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20073r15"></a></span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">&#x00A0;</span><span 
class="cmitt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20074r16"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">using</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">InstructionCounter</span><span 
class="cmtt-10">::</span><span 
class="cmtt-10">counter_</span><span 
class="cmtt-10">;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20075r17"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20076r18"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action_result_type</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20077r19"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Ret</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20078r20"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20079r21"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">counter_</span><span 
class="cmtt-10">++;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20080r22"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">finish</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20081r23"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20082r24"></a></span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20083r25"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">template</span><span 
class="cmtt-10">&#x003C;</span><span 
class="cmbtt-10">class</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Op</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20084r26"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action_result_type</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20085r27"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">action</span><span 
class="cmtt-10">(</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Jmp</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">,</span><span 
class="cmbtt-10">const</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">Op</span><span 
class="cmtt-10">&amp;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">op</span><span 
class="cmtt-10">)</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20086r28"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">{</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20087r29"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">counter_</span><span 
class="cmtt-10">++;</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20088r30"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmbtt-10">return</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">finish</span><span 
class="cmtt-10">(</span><span 
class="cmtt-10">insn</span><span 
class="cmtt-10">);</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20089r31"></a></span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">}</span><span 
class="cmtt-10">&#x00A0;</span><br /><span class="label"><a 
 id="x1-20090r32"></a></span><span 
class="cmtt-10">};</span>
   </div>
<!--l. 876--><p class="indent" >   Note how both direct and indirect <span 
class="cmtt-10">jmp</span> instructions are matched by the following
member declaration:
   <!--l. 879-->
   <div class="lstlisting" id="listing-14"><span class="label"><a 
 id="x1-20091r1"></a></span>template&#x00A0;<span 
class="cmmi-10">&#x003C;</span>class&#x00A0;Op<span 
class="cmmi-10">&#x003E;</span>&#x00A0;<br /><span class="label"><a 
 id="x1-20092r2"></a></span>action_result_type&#x00A0;action(const&#x00A0;Jmp&amp;&#x00A0;insn,const&#x00A0;Op&amp;&#x00A0;op);
   </div>
<!--l. 884--><p class="indent" >   If the user wants to treat the 8-bit direct <span 
class="cmtt-10">jmp</span> instructions specially, it is just as
simple as adding the following member definition: <!--l. 886-->
   <div class="lstlisting" id="listing-15"><span class="label"><a 
 id="x1-20093r1"></a></span>&#x00A0;&#x00A0;action_result_type&#x00A0;action(const&#x00A0;Jmp&amp;&#x00A0;insn,rel8_t&#x00A0;op1);
   </div>
<!--l. 890--><p class="indent" >   Each instruction class is derived from <span 
class="cmtt-10">InstructionData</span>, which is defined in
<span 
class="cmtt-10">erasm/x64_instruction_definition_common.hpp</span>. (Caution: the interface
of this class <span 
class="cmti-10">will </span>change.) Also, for each instruction class a static member
<span 
class="cmtt-10">mnemonic</span> of type <span 
class="cmtt-10">const</span><span 
class="cmtt-10">&#x00A0;char</span><span 
class="cmtt-10">&#x00A0;*</span><span 
class="cmtt-10">&#x00A0;const</span> is defined and holds the obvious
value.
<!--l. 897--><p class="indent" >   Finally, for any operand object <span 
class="cmtt-10">x</span> and for any ostream object <span 
class="cmtt-10">os</span> , the expression
<span 
class="cmtt-10">os</span><span 
class="cmtt-10">&#x00A0;&#x003C;&#x003C;</span><span 
class="cmtt-10">&#x00A0;x</span> is guaranteed to be valid and prints appropriate information.

<!--l. 901--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.4   </span> <a 
 id="x1-210003.4"></a>Performance</h4>
<!--l. 904--><p class="noindent" >We have compared the performance of GenericDsm and several free decoder
libraries for various tasks. The tasks were conducted on the following two
machines:
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">Machine 1</span> </dt><dd 
class="description">Pentium Dual E2220 2.40GHz, Windows 7 32-bit.
     </dd><dt class="description">
<span 
class="cmbx-10">Machine 2</span> </dt><dd 
class="description">Celeron M 1.3GHz, Linux 32-bit.</dd></dl>
<!--l. 911--><p class="noindent" >The results are summarized in Table <a 
href="#x1-230011">1<!--tex4ht:ref: tab:machine1 --></a> and Table <a 
href="#x1-230022">2<!--tex4ht:ref: tab:machine2 --></a>.
<!--l. 914--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-220003.4"></a><span 
class="cmbx-10">Libraries</span></span>
   The libraries used for the comparison are the following:
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">GenericDsm (GD)</span> </dt><dd 
class="description">version 0.10, compiled with:
         <ul class="itemize1">
         <li class="itemize">Mingw gcc 4.6.1 on Machine 1, option -O3
         </li>
         <li class="itemize">Debian gcc 4.6.1-4 on Machine 2, option -O3</li></ul>
     </dd><dt class="description">
<span 
class="cmbx-10">DynamoRIO </span><span class="cite"><span 
class="cmbx-10">[</span><a 
href="#Xdynamorio"><span 
class="cmbx-10">2</span></a><span 
class="cmbx-10">]</span></span> <span 
class="cmbx-10">(DR).</span> </dt><dd 
class="description">The following binary distributions were used:
         <ul class="itemize1">
         <li class="itemize">DynamoRIO-Windows-3.1.0-4 on Machine 1,
         </li>
         <li class="itemize">DynamoRIO-Linux-3.1.0-4 on Machine 2.</li></ul>
     </dd><dt class="description">
<span 
class="cmbx-10">udis86 </span><span class="cite"><span 
class="cmbx-10">[</span><a 
href="#Xudis86"><span 
class="cmbx-10">8</span></a><span 
class="cmbx-10">]</span></span> </dt><dd 
class="description">version 1.7, compiled with:
         <ul class="itemize1">
         <li class="itemize">Mingw gcc 4.6.1 on Machine 1, option -O3
         </li>
         <li class="itemize">Debian gcc 4.6.1-4 on Machine 2, option -O3</li></ul>
     </dd><dt class="description">
<span 
class="cmbx-10">libopcodes </span><span class="cite"><span 
class="cmbx-10">[</span><a 
href="#Xbinutils"><span 
class="cmbx-10">7</span></a><span 
class="cmbx-10">]</span></span><span 
class="cmbx-10">.</span> </dt><dd 
class="description">The following binary distributions were used:
         <ul class="itemize1">
         <li class="itemize">Mingw GNU binutils version 2.21.53.20110804 on Machine 1
         </li>
         <li class="itemize">Debian GNU binutils version 2.21.52.20110606 on Machine 2</li></ul>

     </dd></dl>
<!--l. 945--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-230003.4"></a><span 
class="cmbx-10">Tasks</span></span>
   All the tasks were conducted ten times on the same contiguous block of
instructions. This block consisted of the equal numbers of all supported instructions
in IA-32 mode, totaling 2150000 instructions that consumed about 10M bytes of
memory.
<!--l. 953--><p class="indent" >   The tasks conducted are the following:
     <ul class="itemize1">
     <li class="itemize">Counting the number of instructions in the block.
     </li>
     <li class="itemize">Counting the number of CTIs, the Control Transfer Instructions, which
     include JMP, CALL, Jcc, LOOPcc and other instructions that affect the
     instruction pointer register.
     </li>
     <li class="itemize">Printing disassembly of the same block in Format A (see Table <a 
href="#x1-230033">3<!--tex4ht:ref: tab:formats --></a>).
     </li>
     <li class="itemize">Printing disassembly of the same block in Format B (see Table <a 
href="#x1-230033">3<!--tex4ht:ref: tab:formats --></a>).
     </li>
     <li class="itemize">Printing disassembly of the same block in Format C (see Table <a 
href="#x1-230033">3<!--tex4ht:ref: tab:formats --></a>).</li></ul>
<!--l. 964--><p class="noindent" >In order to give a rough estimate of the significance of IO overhead in these tasks, we
have compared the performance of disassembly in three different formats. This was
necessary because the formatted IO is hard-coded in the decoder functions of some of
the libraries compared.
   <div class="table">

<!--l. 970--><p class="indent" >   <a 
 id="x1-230011"></a><hr class="float"><div class="float" 
>

<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"></colgroup><colgroup id="TBL-2-2g"><col 
id="TBL-2-2"></colgroup><colgroup id="TBL-2-3g"><col 
id="TBL-2-3"></colgroup><colgroup id="TBL-2-4g"><col 
id="TBL-2-4"></colgroup><colgroup id="TBL-2-5g"><col 
id="TBL-2-5"></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-1"  
class="td11"> Task                           </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-2"  
class="td11"> GD  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-3"  
class="td11"> DR    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-4"  
class="td11"> udis86  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-5"  
class="td11"> libopcodes  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-1"  
class="td11"> Count Instructions         </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-2"  
class="td11"> 0.19  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-3"  
class="td11"> 0.11   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-4"  
class="td11"> 5.00     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-5"  
class="td11"> 10.55         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-1"  
class="td11"> Count CTIs                  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-2"  
class="td11"> 0.19  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-3"  
class="td11"> 1.34   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-4"  
class="td11"> N/A    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-5"  
class="td11"> N/A          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-1"  
class="td11"> Disassembly (Format A)  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-2"  
class="td11"> 2.28  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-3"  
class="td11"> N/A   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-4"  
class="td11"> 6.58     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-5"  
class="td11"> N/A          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-1"  
class="td11"> Disassembly (Format B)  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-2"  
class="td11"> 2.89  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-3"  
class="td11"> 14.01  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-4"  
class="td11"> 7.08     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-5"  
class="td11"> N/A          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-1"  
class="td11"> Disassembly (Format C)  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-2"  
class="td11"> 4.10  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-3"  
class="td11"> N/A   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-4"  
class="td11"> 8.75     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-5"  
class="td11"> 18.55         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-7-1"  
class="td11">                       </td></tr></table></div>
<br /> <div class="caption" 
><span class="id">Table&#x00A0;1: </span><span  
class="content">Results on Machine 1 (Pentium Dual E2220 2.40GHz, Windows 7
32-bit). The numbers indicate the average elapsed times in seconds.</span></div><!--tex4ht:label?: x1-230011 -->

   </div><hr class="endfloat" />
   </div>
   <div class="table">

<!--l. 986--><p class="indent" >   <a 
 id="x1-230022"></a><hr class="float"><div class="float" 
>

<div class="tabular"> <table id="TBL-3" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"></colgroup><colgroup id="TBL-3-2g"><col 
id="TBL-3-2"></colgroup><colgroup id="TBL-3-3g"><col 
id="TBL-3-3"></colgroup><colgroup id="TBL-3-4g"><col 
id="TBL-3-4"></colgroup><colgroup id="TBL-3-5g"><col 
id="TBL-3-5"></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-1"  
class="td11"> Task                           </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-2"  
class="td11"> GD  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-3"  
class="td11"> DR    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-4"  
class="td11"> udis86  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-5"  
class="td11"> libopcodes  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-1"  
class="td11"> Count instructions         </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-2"  
class="td11"> 0.33  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-3"  
class="td11"> 0.21   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-4"  
class="td11"> 9.34     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-5"  
class="td11"> 4.99          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-1"  
class="td11"> Count CTIs                  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-2"  
class="td11"> 0.31  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-3"  
class="td11"> 7.86   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-4"  
class="td11"> N/A    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-5"  
class="td11"> N/A          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-1"  
class="td11"> Disassembly (Format A)  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-2"  
class="td11"> 3.99  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-3"  
class="td11"> N/A   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-4"  
class="td11"> 10.56   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-5"  
class="td11"> N/A          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-1"  
class="td11"> Disassembly (Format B)  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-2"  
class="td11"> 4.74  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-3"  
class="td11"> 29.94  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-4"  
class="td11"> 11.47   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-5"  
class="td11"> N/A          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-1"  
class="td11"> Disassembly (Format C)  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-2"  
class="td11"> 6.83  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-3"  
class="td11"> N/A   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-4"  
class="td11"> 13.79   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-5"  
class="td11"> 14.44         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-7-1"  
class="td11">                       </td></tr></table></div>
<br /><div class="caption" 
><span class="id">Table&#x00A0;2: </span><span  
class="content">Results on Machine 2 (Celeron M 1.3GHz, Linux 32-bit). The numbers
indicate the average elapsed times in seconds.</span></div><!--tex4ht:label?: x1-230022 -->

   </div><hr class="endfloat" />
   </div>
   <div class="table">

<!--l. 1001--><p class="indent" >   <a 
 id="x1-230033"></a><hr class="float"><div class="float" 
>

<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1"></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2"><col 
id="TBL-4-3"><col 
id="TBL-4-4"><col 
id="TBL-4-5"></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-1"  
class="td11">          </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-2"  
class="td11"> Opcode  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-3"  
class="td11"> Address   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-4"  
class="td11"> Length  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-5"  
class="td11"> Instruction  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-1"  
class="td11"> Format A:  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-3"  
class="td11">          </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-5"  
class="td11"> adc al,0x12  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-1"  
class="td11"> Format B:  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-3"  
class="td11"> 08159c18  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-5"  
class="td11"> adc al,0x12  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-1"  
class="td11"> Format C:  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-2"  
class="td11"> 1412      </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-3"  
class="td11"> 08159c18  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-4"  
class="td11"> 2          </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-5"  
class="td11"> adc al,0x12  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-5-1"  
class="td11">           </td></tr></table></div>
<br /> <div class="caption" 
><span class="id">Table&#x00A0;3: </span><span  
class="content">Disassembly formats used for the comparison.</span></div><!--tex4ht:label?: x1-230033 -->

   </div><hr class="endfloat" />
   </div>
<!--l. 1015--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-240003.4"></a><span 
class="cmbx-10">Conclusions</span></span>
     <ul class="itemize1">
     <li class="itemize">DynamoRIO  uses  adaptive  level-of-detail  instruction  representation&#x00A0;<span class="cite">[<a 
href="#Xbruening:dynamorio">3</a>]</span>
     and  provides  specialized  decoder  functions  for  each  representation.  In
     particular, it provides a very fast instruction decoder <span 
class="cmtt-10">decode_next_pc</span>
     which  calculates  only  the  next  instruction  address.  This  was  the  only
     function that outperformed GenericDsm in this comparison.
     </li>
     <li class="itemize">In all other tasks, GenericDsm was 2-70 times faster than other libraries.
     </li>
     <li class="itemize">The three libraries we have compared against use <span 
class="cmtt-10">printf</span> or its variants
     for formatted output, whereas GenericDSM uses a custom ostream object
     <span 
class="cmtt-10">erasm::cout</span> which turned out be slightly faster in some cases than printf
     or its variants.
     </li>
     <li class="itemize">In libopcodes and udis86, the formatted IO code is tightly coupled in
     the  decoder  function  and  there  seems  to  be  no  easy  way  to  measure
     overheads related to formatted IO separately. This means that even mere
     instruction counting involves some overhead related to formatted IO in
     these libraries. In contrast, GenericDsm could easily adapt to all the tasks
     with no unnecessary overheads.</li></ul>
<!--l. 1042--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.5   </span> <a 
 id="x1-250003.5"></a>Limitations</h4>
     <ul class="itemize1">
     <li class="itemize">Slow compilation.
     </li>
     <li class="itemize">Can cause code bloat if instantiated to too many actions.
     </li>
     <li class="itemize">No support for symbol resolution.
     </li>
     <li class="itemize">No support for detecting the instruction&#8217;s effects on the <span 
class="cmtt-10">eflags</span> register.

     </li>
     <li class="itemize">Only relatively recent, reasonably standard conformant compilers can be
     used.
     </li>
     <li class="itemize">Compilation errors can cause long and unfriendly error messages.
     </li>
     <li class="itemize">The library interface is still unstable.</li></ul>
<!--l. 1056--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-260004"></a>License</h3>
<!--l. 1057--><p class="noindent" >Copyright 2010&#8211;2012 Makoto Nishiura.
<!--l. 1059--><p class="indent" >   Erasm++ is free software; you can redistribute it and/or modify it under the
terms of the GNU General Public License as published by the Free Software
Foundation; either version 3, or (at your option) any later version.
<!--l. 1064--><p class="indent" >   Erasm++ is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
for more details.
<!--l. 1069--><p class="indent" >   You should have received a copy of the GNU General Public License along with
Erasm++; see the file COPYING. If not see <a 
href="http://www.gnu.org/licenses/" class="url" ><span 
class="cmtt-10">http://www.gnu.org/licenses/</span></a>.
<!--l. 1--><p class="noindent" >
   <h3 class="likesectionHead"><a 
 id="x1-270004"></a>References</h3>
<!--l. 1--><p class="noindent" >
   <div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xlinux:cpp_kernel"></a>Jeremy     Andrews.              Linux:     C++     In     The     Kernel?
   <a 
href="http://kerneltrap.org/node/2067" class="url" ><span 
class="cmtt-10">http://kerneltrap.org/node/2067</span></a>, 2004.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xdynamorio"></a>Derek      Bruening      and      Qin      Zhao.                DynamoRIO.
   <a 
href="http://dynamorio.org/home.html" class="url" ><span 
class="cmtt-10">http://dynamorio.org/home.html</span></a>.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [3]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xbruening:dynamorio"></a>Derek&#x00A0;L. Bruening. <span 
class="cmti-10">Efficient, Transparent, and Comprehensive Runtime</span>
   <span 
class="cmti-10">Code Manipulation</span>.  PhD thesis, Department of Electrical Engineering and
   Computer Science,Massachusetts Institute of Technology, 2004.

   </p>
   <p class="bibitem" ><span class="biblabel">
 [4]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xintel:opt_ref"></a>Intel  Corporation.    Intel  64  and  IA-32  Architectures  Optimization
   Reference Manual, 2011.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [5]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xintel:insn_ref"></a>Intel Corporation. Intel 64 and IA-32 Architectures Software Developer&#8217;s
   Manual Combined Volumes 2A, 2B, and 2C: Instruction Set Reference, A-Z,
   2011.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [6]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xms:cpp_kernel"></a>Microsoft Corporation.  C++ for Kernel Mode Drivers: Pros and Cons.
   <a 
href="http://msdn.microsoft.com/en-us/windows/hardware/gg487420" class="url" ><span 
class="cmtt-10">http://msdn.microsoft.com/en-us/windows/hardware/gg487420</span></a>, 2007.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [7]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xbinutils"></a>Free&#x00A0;Software         Foundation.                         GNU         Binutils.
   <a 
href="http://www.gnu.org/software/binutils/" class="url" ><span 
class="cmtt-10">http://www.gnu.org/software/binutils/</span></a>.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [8]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xudis86"></a>Vivek Thampi. udis86. <a 
href="http://udis86.sourceforge.net/" class="url" ><span 
class="cmtt-10">http://udis86.sourceforge.net/</span></a>.
</p>
   </div>
    
</body></html> 



